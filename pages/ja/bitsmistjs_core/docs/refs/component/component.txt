====== Component ======

''継承:HTMLElement''

===== 概要 =====

BitsmistJSの核となるコンポーネントオブジェクトです。HTMLElementを継承しているため、通常のHTML要素の機能を引き継いでいます。自分のコンポーネントを作成する場合は、このComponentを継承して作成します。

Componentはデフォルトで以下のオーガナイザをアタッチしています。

  * [[ja:bitsmistjs_core:docs:refs:organizer:organizer|OrganizerOrganizer]]
  * [[ja:bitsmistjs_core:docs:refs:organizer:setting|SettingOrganizer]]
  * [[ja:bitsmistjs_core:docs:refs:organizer:state|StateOrganizer]]
  * [[ja:bitsmistjs_core:docs:refs:organizer:event|EventOrganizer]]
  * [[ja:bitsmistjs_core:docs:refs:organizer:loader|LoaderOrganizer]]
  * [[ja:bitsmistjs_core:docs:refs:organizer:template|TemplateOrganizer]]


===== 設定 =====

Componentの設定は”settings”セクションに記述します。

==== autoFetch ====
''型:Boolean'' ''デフォルト:true''

Trueの場合、[[#refresh_options|refresh()]]メソッドを呼ぶと自動的に[[#fetch_options|fetch()]]メソッドも呼び出されます。

==== autoFill ====
''型:Boolean'' ''デフォルト:true''

Trueの場合、[[#refresh_options|refresh()]]メソッドを呼ぶと自動的に[[#fill_options|fill()]]メソッドも呼び出されます。

==== autoMorph ====
''型:String/Boolean'' ''Default:"BITSMIST.v1.Component"''

タグをインスタンス化する際、クラスのJSファイルをロードせずに、指定された既に存在するクラスを使用します。

==== autoPostStart ====
''型:Boolean'' ''デフォルト:true''

Trueの場合、初期化の後部処理を自動的に呼び出します。主にコンポーネントを継承した際に、初期化フローをコントロールするために使用されます。

==== autoRefresh ====
''型:Boolean'' ''デフォルト:true''

Trueの場合、初期化終了時に自動的に[[#refresh_options|refresh()]]メソッドが呼び出されます。

==== autoRestart ====
''型:Boolean'' ''デフォルト:false''

Trueの場合、コンポーネントがドキュメントツリーにアタッチされた際に、たとえ初期化済みであっても再度[[#start_settings|start()]]メソッドを呼び出します。

==== autoSetup ====
''型:Boolean'' ''デフォルト:true''

Trueの場合、自動的に[[#setup_options|setup()]]メソッドが呼び出されます。

==== autoStop ====
''型:Boolean'' ''デフォルト:true''

Trueの場合、コンポーネントがドキュメントツリーから切り離された際に、[[#stop_options|stop()]]メソッドを実行します。

==== className ====
''型:String'' ''デフォルト:<コンポーネント名>''

コンポーネントのクラス名を指定します。指定がない場合は、コンポーネント名がクラス名になります。

==== fileName ====
''型:String'' ''デフォルト:<クラス名>''

コンポーネントのファイル名を指定します。指定がない場合は、クラス名がファイル名となります。
==== hasTemplate ====
''型:Boolean'' ''デフォルト:true''

コンポーネントがテンプレートHTMLを持つかを指定します。Trueの場合、初期化の途中で自動的に[[#switchtemplate_templatename_options|switchTemplate()]]が呼び出され、テンプレートHTMLの読み込みと差し込みが行われます。

====loaderName====
''型:String'' ''Default:"DefaultLoader"''

使用するローダの名前を指定します。ローダはクラスのJSファイルやテンプレートHTMLなどをロードするのに使われます。

==== name ====
''型:String'' ''デフォルト:<クラス名>''

コンポーネント名を指定します。

==== overwrite ====
''型:Boolean'' ''デフォルト:false''

親ノードを上書きするかを指定します。Trueの場合、親ノードはコンポーネントで上書きされます。

====path====
''型:String''

コンポーネントのパスを指定します。

==== rootNode ====
''型:String'' ''デフォルト:<空>''

このコンポーネントがアタッチするノードを指定します。

==== splitComponent ====
''型:Boolean'' ''デフォルト:false''

コンポーネントのファイルが分割されているかを指定します。Trueの場合、ローダーは2つのファイルを読み込みます。

==== sync ====
''型:String/Boolean'' ''デフォルト:false''

文字列が指定された場合、追加したコンポーネントが指定したステートになるのを待ちます。Trueの場合は、”started”になるのを待ちます。
==== tag ====
''型:String'' ''デフォルト:<空>''

コンポーネントのタグを指定します。この値でHTMLに挿入されます。tagNameと違い、属性やクラスも指定できます。

==== tagName ====
''型:String'' ''デフォルト:<説明参照>''

このコンポーネントのタグの名前を指定します。指定されてない場合、タグ名はクラス名から生成されます。クラス名はパスカルケースと仮定し、2つ目の大文字の文字を境に2つの単語に区切られ、ハイフンで連結されます。

==== templateName ====
''型:String'' ''デフォルト:<タグ名>''

テンプレートファイル名を拡張子なしで指定します。ファイル取得時に拡張子”.html”を追加したファイル名を取得します。
==== useGlobalSettings ====
''型:Boolean'' ''デフォルト:true''

グローバル設定をコンポーネントに反映させるかを指定します。Trueの場合、コンポーネントの設定がグローバル設定に連結されます。

<WRAP admonition tip links>
設定の連結機能は、ChainableStoreクラスを使って実装されています。
  * <html><i class="fas fa-link"></i></html>[[ja:bitsmistjs_core:docs:refs:util:chainablestore|リファレンス - ストア - ChainableStore]]
</WRAP>

===== タグ属性 =====

いくつかのコンポーネントの設定は、タグ属性に指定することもできます。タグ属性は設定より高い優先度を持っています。

====bm-autoload====

''型:String''

コンポーネントを自動的にロードするかを指定します。値としてコンポーネントのURLを指定します。もし値がセットされてない場合、デフォルトのパスからコンポーネントがロードされます。

====bm-automorph====

''型:(なし)''

Indicates to load an HTML file from the default path. No value is needed. 設定の[[#automorph|"settings.autoMorph"]]と同じです。

====bm-classname====

''型:String''

コンポーネントのクラス名を指定します。設定の[[#classname|"settings.className"]]と同じです。

====bm-path====

''型:String''

コンポーネントやテンプレートHTMLをロードするパスを指定します。設定の[[#path|"settings.path"]]と同じです。

====bm-settingref====
''型:String''

設定ファイルへのURLを指定します。この設定ファイルは非同期に読み込まれます。

====bm-settings====
''型:String''

設定をjson形式で指定します。ここで指定した設定は”settings”セクション内に記述されたものとみなされ、現在の設定にマージされます。

====bm-split====

''型:(なし)''

この属性が存在する場合、コンポーネントが分割形式とみなします。設定の[[#splitcomponent|"settings.splitComponent"]]と同じです。値は不要です。


===== イベント =====

====afterAppend====

[[#switchtemplate_templatename_options|switchTemplate()]]メソッドが呼ばれ、テンプレートHTMLがコンポーネントにアタッチされた後に発生します。コンポーネントがテンプレートHTMLを持ってない場合（[[#hastemplate|”settings.hasTemplate”]]オプションがfalseの場合）、このイベントは発生しません。

=== パラメータ ===

^パラメータ^型^説明^
|options|Object|[[#switchtemplate_templatename_options|switchTemplate()]]メソッドに渡されたoptions引数です。|

====afterFetch====

doFetchイベントの後に発生します。

=== パラメータ ===

^パラメータ^型^説明^
|options|Object|[[#fetch_options|fetch()]]メソッドに渡されたoptions引数です。|

====afterRefresh====

doRefreshイベントの後に発生します。

=== パラメータ ===

^パラメータ^型^説明^
|options|Object|[[#refresh_options|refresh()]]メソッドに渡されたoptions引数です。|

==== afterSetup ====

doSetupイベントの後に発生します。

=== パラメータ ===

^パラメータ^型^説明^
|options|Object|[[#setup_options|setup()]]メソッドに渡されたoptions引数です。|

==== afterStart ====

コンポーネントの初期化処理の終了付近で発生します。

=== パラメータ ===

^パラメータ^型^説明^
|options|Object|[[#start_settings|start()]]メソッドに渡されたoptions引数です。|

==== afterStop ====

doStopイベントの後に発生します。

=== パラメータ ===

^パラメータ^型^説明^
|options|Object|[[#stop_options|stop()]]メソッドに渡されたoptions引数です。|

====beforeFetch====

[[#fetch_options|fetch()]]メソッドが呼ばれた際に発生します。

=== パラメータ ===

^パラメータ^型^説明^
|options|Object|[[#fetch_options|fetch()]]メソッドに渡されたoptions引数です。|

====beforeRefresh====

[[#refresh_options|refresh()]]メソッドが呼ばれた際に発生します。

=== パラメータ ===

^パラメータ^型^説明^
|options|Object|[[#refresh_options|refresh()]]メソッドに渡されたoptions引数です。|

==== beforeSetup ====

[[#setup_options|setup()]]メソッドが呼びされた際に発生します。デフォルトでは初期化中に[[#setup_options|setup()]]メソッドが自動的に呼び出されます。コンポーネントがテンプレートHTMLを持っている場合、テンプレートHTMLがノードにアタッチされた後に発生します。

=== パラメータ ===

^パラメータ^型^説明^
|options|Object|[[#setup_options|setup()]]メソッドに渡されたoptions引数です。|

==== beforeStart ====

[[#start_settings|start()]]メソッドが呼び出された時に発生します。コンポーネントがドキュメントツリーにアタッチされた時（connectedCallbackイベント発生時）に[[#start_settings|start()]]メソッドが自動的に呼び出されます。

=== パラメータ ===

^パラメータ^型^説明^
|options|Object|[[#start_settings|start()]]メソッドに渡されたoptions引数です。|

==== beforeStop ====

[[#stop_options|stop()]]メソッドが呼び出された時に発生します。デフォルトではコンポーネントがドキュメントツリーから切り離された時（disconnectedCallback発生時）に[[#stop_options|stop()]]メソッドが自動的に呼び出されます。

=== パラメータ ===

^パラメータ^型^説明^
|options|Object|[[#stop_options|stop()]]メソッドに渡されたoptions引数です。|

====doFetch====

beforeFetchイベントの後に発生します。

=== パラメータ ===

^パラメータ^型^説明^
|options|Object|[[#fetch_options|fetch()]]メソッドに渡されたoptions引数です。|

====doRefresh====

doTargetイベントの後に発生します。

=== パラメータ ===

^パラメータ^型^説明^
|options|Object|[[#refresh_options|refresh()]]メソッドに渡されたoptions引数です。|

====doSetup ====

beforeSetupイベントの後に発生します。

=== パラメータ ===

^パラメータ^型^説明^
|options|Object|[[#setup_options|setup()]]メソッドに渡されたoptions引数です。|

====doStop ====

beforeStopイベントの後に発生します。

=== パラメータ ===

^パラメータ^型^説明^
|options|Object|[[#stop_options|stop()]]メソッドに渡されたoptions引数です。|

====doTarget====

beforeRefreshイベントの後に発生します。

=== パラメータ ===

^パラメータ^型^説明^
|options|Object|[[#refresh_options|refresh()]]メソッドに渡されたoptions引数です。|

===== プロパティ =====

==== name ====

''型:String'' ''デフォルト:<クラス名>'' ''get''

コンポーネントの名前です。設定の[[#name|”settings.name”]]で指定可能です。

==== rootElement ====

''型:HTMLElement'' ''デフォルト:this'' ''get''

コンポーネントのルートとなるHTML要素です。通常は”this”と同じです。


==== uniqueId ====

''型:String'' ''get''

コンポーネントのインスタンスごとに割り当てられるユニークなIDです。自動的に生成されます。

===== メソッド =====

==== clear(options) ====

''型:undefined''

このコンポーネントをクリアします。実際にはこのベースクラスでは何もしないため、オーバーライドする必要があります。

=== パラメータ ===

^パラメータ^型^説明^
|options|Object|設定情報です。|

=== 戻り値 ===

なし。

==== fetch(options) ====

''型:undefined'' ''非同期''

コンポーネントに必要なデータを取得します。

=== パラメータ ===

^パラメータ^型^説明^
|options|Object|設定情報です。トリガするイベントにオプションとして渡されます。|

=== 戻り値 ===

なし。

=== イベント ===

  * [[#afterfetch|afterFetch]]
  * [[#beforefetch|beforeFetch]]
  * [[#dofetch|doFetch]]

=== オーガナイザイベント ===

  * doFetch

==== fill(options) ====

''型:undefined''

コンポーネントに値を埋め込みます。 実際にはこのベースクラスでは何もしないため、オーバーライドする必要があります。

=== パラメータ ===

^パラメータ^型^説明^
|options|Object|設定情報です。|

=== 戻り値 ===

なし。

==== refresh(options) ====

''型:undefined'' ''非同期''

コンポーネントを再描画します。[[#autofetch|”settings.autoFetch”]]オプションがTrueの場合は[[#fetch_options|fetch()]]メソッドを、[[#autofill|”settings.autoFill”]]オプションがTrueの場合は[[#fill_options|fill()]]メソッドを自動的に呼び出します。

条件付要素（"bm-visible"属性を持つ要素）は条件に合致すれば、このタイミングで表示されます。

<WRAP admonition tip links>
これはTemplateOrganizerのshowConditionalElements()拡張メソッドを呼び出すことで、行われます。
  * <html><i class="fas fa-link"></i></html>[[en:bitsmistjs_core:docs:refs:organizer:template#showconditionalelements_item|Reference - organizer - TemplateOrganizer.showConditionalElements()]]
</WRAP>

=== パラメータ ===

^パラメータ^型^説明^
|options|Object|設定情報です。トリガするイベントにオプションとして渡されます。|

=== 戻り値 ===

なし。

=== イベント ===

  * [[#afterrefresh|afterRefresh]]
  * [[#beforerefresh|beforeRefresh]]
  * [[#dorefresh|doRefresh]]
  * [[#dotarget|doTarget]]

===参照する設定===

  * [[#autofetch|settings.autoFetch]]
  * [[#autofill|settings.autoFill]]
==== scopedSelectorAll(query) ====

''型:NodeList''

自身の配下にある、指定されたクエリーに合致するHTML要素を返します。

=== パラメータ ===

^パラメータ^型^説明^
|query \\ ''必須''|String|検索クエリーです。document.querySelectorAll()と同じ書式を使います。|

=== 戻り値 ===

クエリーに合致するHTML要素のNodeListです。

==== setup(options) ====

''型:undefined'' ''非同期''

コンポーネントをセットアップします。設定を変更した場合などに呼び出します。

=== パラメータ ===

^パラメータ^型^説明^
|options|Object|設定情報です。トリガするイベントにオプションとして渡されます。|

=== 戻り値 ===

なし。

=== イベント ===

  * [[#aftersetup|afterSetup]]
  * [[#beforesetup|beforeSetup]]
  * [[#dosetup|doSetup]]

==== start(settings) ====

''型:undefined'' ''非同期''

コンポーネントの初期化を開始します。タグがインスタンス化されるときに自動的に呼び出されるため、通常は呼び出す必要はありません。

=== パラメータ ===

^パラメータ^型^説明^
|settings|Object|設定情報です。|

=== 戻り値 ===

なし。

=== イベント ===

  * [[#afterstart|afterStart]]
  * [[#beforestart|beforeStart]]

=== オーガナイザイベント ===

  * afterStart
  * beforeStart

===参照する設定===

  * [[#automorph|settings.autoMorph]]
  * [[#autopoststart|settings.autoPostStart]]
  * [[#autorefresh|settings.autoRefresh]]
  * [[#autosetup|settings.autoSetup]]
  * [[#hastemplate|settings.hasTemplate]]
  * [[#name|settings.name]]
  * [[#rootelement|settings.rootElement]]

==== stop(options) ====

''型:undefined'' ''非同期''

コンポーネントの終了処理を行います。タグが切り離された時に自動的に呼び出されるため、通常は呼び出す必要はありません。

=== パラメータ ===

^パラメータ^型^説明^
|options|Object|設定情報です。トリガするイベントにオプションとして渡されます。|

=== 戻り値 ===

なし。

=== イベント ===

  * [[#beforestop|beforeStop]]
  * [[#dostop|doStop]]
  * [[#afterstop|afterStop]]

==== switchTemplate(templateName, options) ====

''型:undefined'' ''非同期''

テンプレートHTMLを切り替えます。HTMLファイルがまだロードされてない場合は、自動的にロードされます。ロードされたHTMLファイルは自身にアタッチされます。追加された後、テンプレート内にオートロードの必要があるタグがある場合は、さらにそれらをロードします。

テンプレートHTMLがアタッチされた際、bm-visible属性をもつ要素は、全て一旦非表示になります。

<WRAP admonition tip links>
これはTemplateOrganizerのhideConditionalElements()拡張メソッドを呼び出すことで行われます。
  * <html><i class="fas fa-link"></i></html>[[ja:bitsmistjs_core:docs:refs:organizer:template#hideconditionalelements|リファレンス - オーガナイザ - TemplateOrganizer.hideConditionalElements()]]
</WRAP>
非表示になった要素は画面の再描画時（refresh()メソッドが呼ばれた時）に、条件に応じて表示されます。

[[#autosetup|”settings.autoSetup”]]オプションがTrueの場合、テンプレートHTMLのアタッチ後に[[#setup_options|setup()]]メソッドを呼び出します。

=== パラメータ ===

^パラメータ^型^説明^
|templateName \\ ''必須''|String|切り替え先のテンプレート名です。|
|options|Object|設定情報です。トリガするイベントにオプションとして渡されます。|

=== 戻り値 ===

なし。

=== イベント ===

  * [[#afterappend|afterAppend]]

=== オーガナイザイベント ===

  * afterAppend

===参照する設定===

  * [[#autosetup|settings.autoSetup]]